FROM <%= config[:image] %>

# * Test-Kitchen needs bash to login into the container.
# * "apk add --no-cache" will install packages running first apk update and
# then rm -rf /var/cache/apk/*
# * add community edge repository to install shadow package
# * install shadow to get usermod and groupmod commands
# * sudo is needed for entrypoint.sh
RUN echo "http://dl-cdn.alpinelinux.org/alpine/edge/community" >> /etc/apk/repositories && \
 apk add --no-cache bash shadow sudo git
RUN git clone --depth 1 https://github.com/sstephenson/bats.git && \
  git clone --depth 1 https://github.com/ztombol/bats-support.git && \
  git clone --depth 1 https://github.com/ztombol/bats-assert.git && \
  /bats/install.sh /usr/local

# make ide scripts available in Docker build context, so that we can
# install them later (using install.sh)
COPY src /tmp/ide_image_scripts_src
