{
  "name" : "ide.ci",
  "group" : "ide",
  "label_template": "${git}",
  "materials" : [
    {
      "type" : "git",
      "name" : "git",
      "url" : "git@git.ai-traders.com:ide/ide.git",
      "branch" : "ci"
    }
  ],
  "stages" : [
    {
      "name" : "style-unit",
      "clean_working_directory": true,
      "jobs" : [
        {
          "name" : "validate_repo",
          "resources" : ["docker","small"],
          "tasks" : [
            {
              "type": "plugin",
              "run_if": "passed",
              "configuration": [
                {
                  "key": "script",
                  "value": "ide --idefile RubyIdefile rake go:git:destructive_validate_repo"
                }
              ],
              "plugin_configuration": {
                "id": "script-executor",
                "version": "1"
              }
            }
          ]
        },
        {
          "name" : "shellcheck",
          "resources" : ["docker","small"],
          "tasks" : [
            {
              "type": "plugin",
              "run_if": "passed",
              "configuration": [
                {
                  "key": "script",
                  "value": "ide rake go:style:shellcheck"
                }
              ],
              "plugin_configuration": {
                "id": "script-executor",
                "version": "1"
              }
            }
          ]
        },
        {
          "name" : "shpec",
          "resources" : ["docker","small"],
          "tasks" : [
            {
              "type": "plugin",
              "run_if": "passed",
              "configuration": [
                {
                  "key": "script",
                  "value": "ide rake go:unit:shpec"
                }
              ],
              "plugin_configuration": {
                "id": "script-executor",
                "version": "1"
              }
            }
          ]
        },
        {
          "name" : "repocritic",
          "resources" : ["docker","small"],
          "tasks" : [
            {
              "type": "plugin",
              "run_if": "passed",
              "configuration": [
                {
                  "key": "script",
                  "value": "ide --idefile RubyIdefile rake go:style:repocritic"
                }
              ],
              "plugin_configuration": {
                "id": "script-executor",
                "version": "1"
              }
            }
          ]
        }
      ]
    },
    {
      "name" : "itest",
      "jobs" : [
        {
          "name" : "test_install",
          "resources" : ["docker", "small"],
          "tasks" : [
            {
              "type": "plugin",
              "run_if": "passed",
              "configuration": [
                {
                  "key": "script",
                  "value": "ide rake go:itest:test_install"
                }
              ],
              "plugin_configuration": {
                "id": "script-executor",
                "version": "1"
              }
            }
          ]
        },
        {
          "name" : "test_image",
          "resources" : ["build_docker"],
          "tasks" : [
            {
              "type": "plugin",
              "run_if": "passed",
              "configuration": [
                {
                  "key": "script",
                  "value": "ide rake go:itest:test_image"
                }
              ],
              "plugin_configuration": {
                "id": "script-executor",
                "version": "1"
              }
            }
          ]
        }
      ]
    },
    {
      "name" : "release",
      "jobs" : [
        {
          "name" : "release",
          "resources" : ["docker","small"],
          "tasks" : [
            {
              "type": "plugin",
              "run_if": "passed",
              "configuration": [
                {
                  "key": "script",
                  "value": "ide --idefile RubyIdefile rake go:release:code"
                }
              ],
              "plugin_configuration": {
                "id": "script-executor",
                "version": "1"
              }
            }
          ]
        }
      ]
    }
  ]
}
